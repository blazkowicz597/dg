<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doƒüum G√ºn√º S√ºrprizi üéÇ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    /* Masa√ºst√ºnden mobile kadar uyumlu boyutlar */
    --gift-size: clamp(80px, 16vw, 128px);
    --glow-size: calc(var(--gift-size) + 32px);
    --heading-size: clamp(22px, 4.5vw, 36px);
  }
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(150deg, rgb(38, 36, 209), rgb(180, 0, 0));
    height: 100vh;
    font-family: 'Poppins', sans-serif;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
    position: relative;
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }

  h1 {
    font-size: var(--heading-size);
    margin-bottom: 10px;
    z-index: 2;
  }

  /* Basit buton stili */
  .btn {
    appearance: none;
    border: 0;
    background: rgba(255,255,255,0.15);
    color: #fff;
    padding: 10px 14px;
    border-radius: 10px;
    font-family: inherit;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.2s ease;
  }
  .btn:hover { background: rgba(255,255,255,0.25); transform: translateY(-1px); }
  .btn:active { transform: translateY(0); }
  .btn:focus-visible { outline: 3px solid rgba(255,255,255,0.8); outline-offset: 3px; }

  .gift {
    display: inline-block;
    font-size: 0;
    cursor: pointer;
    margin: 15px;
    transition: transform 0.3s;
    z-index: 2;
    background: transparent;
    border: none;
    color: inherit;
    padding: 0;
    line-height: 1;
    width: var(--gift-size);
    height: var(--gift-size);
    background-image: url('gbox.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    position: relative;
    will-change: transform, opacity;
  }

  .gift:hover { transform: scale(1.3); }

  .gift:focus-visible {
    outline: 3px solid rgba(255,255,255,0.9);
    outline-offset: 4px;
    transform: scale(1.15);
  }

  /* Renkli glow: kan kƒ±rmƒ±zƒ±sƒ± ve gece mavisi */
  .gift::before {
    content: "";
    position: absolute;
    left: 50%;
    top: 50%;
    width: var(--glow-size);
    height: var(--glow-size);
    transform: translate(-50%, -50%);
    background:
      radial-gradient(closest-side, rgba(139, 0, 0, 0.55), rgba(139, 0, 0, 0) 70%) 25% 60% / 70% 70% no-repeat,
      radial-gradient(closest-side, rgba(25, 25, 112, 0.55), rgba(25, 25, 112, 0) 70%) 75% 40% / 70% 70% no-repeat;
    filter: blur(16px);
    opacity: 1;
    pointer-events: none;
    z-index: -1;
    border-radius: 16px;
  }

  /* K√º√ß√ºk ekranlarda satƒ±r kƒ±rƒ±mƒ± ve kenar bo≈üluklarƒ± */
  #gifts {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px 12px;
  }

  /* Final overlay */
  #finalOverlay {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.45);
    z-index: 5;
    padding: 16px;
  }
  #finalCard {
    background: rgba(20, 20, 40, 0.8);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 14px;
    max-width: 800px;
    width: 100%;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    backdrop-filter: blur(6px);
  }
  #countdown { font-size: 18px; opacity: 0.9; margin: 8px 0 12px; }

  /* Dokunmatik cihazlarda hover b√ºy√ºtmeyi devre dƒ±≈üƒ± bƒ±rak */
  @media (hover: none) {
    .gift:hover { transform: none; }
    .gift:focus-visible { transform: none; }
  }

  /* Telefonlar i√ßin ince ayar */
  @media (max-width: 480px) {
    :root {
      --gift-size: clamp(68px, 20vw, 112px);
      --glow-size: calc(var(--gift-size) + 28px);
      --heading-size: clamp(20px, 6vw, 28px);
    }
    body { padding: 8px; }
    #gifts { gap: 8px 10px; }
    #message { font-size: 20px; min-height: 90px; }
  }

  #message {
    margin-top: 20px;
    font-size: 26px;
    line-height: 1.6;
    max-width: 90%;
    min-height: 100px;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
    z-index: 2;
  }

  .stars {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
  }

  /* ƒ∞√ßerik konteynerini tam ortala */
  #game {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    gap: 8px;
  }

  .star {
    position: absolute;
    background: white;
    width: 3px;
    height: 3px;
    border-radius: 50%;
    opacity: 0.8;
    animation: twinkle 2s infinite ease-in-out;
  }

  @keyframes twinkle {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.5); }
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 3;
    pointer-events: none;
  }

  @media (prefers-reduced-motion: reduce) {
    .star { animation: none; }
    .gift { transition: none; }
    #message { transition: none; }
  }

  /* Yukarƒ± doƒüru bozulma (warp) animasyonu */
  @keyframes giftWarp {
    0% {
      transform: translateY(0) scale(1) skewY(0deg) rotate(0deg);
      filter: blur(0px);
      opacity: 1;
    }
    60% {
      transform: translateY(-24px) scale(0.95) skewY(-6deg);
      filter: blur(1px);
      opacity: 1;
    }
    100% {
      transform: translateY(-72px) scale(0.85) skewY(8deg);
      filter: blur(2px);
      opacity: 0;
    }
  }

  .gift.warp {
    animation: giftWarp 600ms cubic-bezier(.2,.8,.2,1) forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    .gift.warp { animation-duration: 200ms; }
  }
</style>
</head>
<body>

<div class="stars" id="stars"></div>

<div id="game">
  <h1>Doƒüum G√ºn√ºn Kutlu Olsunnn Bitanemmm üéâ</h1>
  <div>
    <button id="restart" class="btn" type="button">Ba≈ütan Ba≈ülat</button>
  </div>
  <div id="gifts">
    <button class="gift" type="button" aria-label="Hediye 1"></button>
    <button class="gift" type="button" aria-label="Hediye 2"></button>
    <button class="gift" type="button" aria-label="Hediye 3"></button>
  </div>
  <div id="progress" style="font-size:14px; opacity:0.9; margin-top:4px; min-height:20px;"></div>
  <div id="message" aria-live="polite" aria-atomic="true"></div>
</div>

<!-- Final y√∂nlendirme onayƒ± / geri sayƒ±m overlay -->
<div id="finalOverlay" role="dialog" aria-modal="true" aria-labelledby="finalTitle">
  <div id="finalCard">
    <div id="finalTitle" style="font-size:18px; font-weight:600;">Asƒ±l S√ºrprizin geliyor g√ºzelimmm </div>
    <div id="countdown">6 saniye i√ßinde video a√ßƒ±lacak...</div>
    <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
      <button id="stayBtn" class="btn" type="button">Burada Kal</button>
      <button id="goNowBtn" class="btn" type="button">youtube'de izlemeye git</button>
    </div>
    <div id="videoContainer" style="display:none; margin-top:12px; aspect-ratio:16/9; width:100%;">
      <iframe id="ytPlayer" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
    </div>
  </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
  // ‚≠ê Yƒ±ldƒ±z efekti
  const reducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const starsContainer = document.getElementById("stars");
  const starCount = reducedMotion ? 30 : 60;
  for (let i = 0; i < starCount; i++) {
    const star = document.createElement("div");
    star.classList.add("star");
    star.style.top = Math.random() * 100 + "%";
    star.style.left = Math.random() * 100 + "%";
    if (!reducedMotion) {
      star.style.animationDelay = Math.random() * 2 + "s";
    }
    starsContainer.appendChild(star);
  }

  // üéÅ Mesajlar
  const messages = [
    "ƒ∞yi ki doƒüdun G√∂zdemmmmm, t√ºm hayatƒ±nƒ±n her g√ºn√º g√ºl√º≈ü√ºn kadar g√ºzel ge√ßsin.‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è",
    "G√ºl√º≈ü√ºn d√ºnyamƒ± aydƒ±nlatƒ±yor. Seni √ßok seviyorummmm ƒ∞yi ki varsƒ±nüíñüíóü•∞üíû",
    "Yeni ya≈üƒ±n sana huzur, sevgi ve unutulmaz anƒ±lar getirsin G√∂zdem, bende bu sƒ±rada senin sevgine layƒ±k olacaƒüƒ±mm √∂mr√ºmm.üéâüéâüéâ"
  ];

  const gifts = document.querySelectorAll(".gift");
  const messageBox = document.getElementById("message");
  const restartBtn = document.getElementById("restart");
  const finalOverlay = document.getElementById("finalOverlay");
  const countdownEl = document.getElementById("countdown");
  const stayBtn = document.getElementById("stayBtn");
  const goNowBtn = document.getElementById("goNowBtn");
  const progressEl = document.getElementById("progress");
  const videoContainer = document.getElementById("videoContainer");
  const ytPlayer = document.getElementById("ytPlayer");

  let clickedCount = 0;
  let isAnimating = false;
  let redirectTimer = null;
  let countdownTimer = null;
  let hasStartedPlayback = false;
  let lastFocusedBeforeOverlay = null;

  function updateProgress() {
    progressEl.textContent = `${clickedCount}/${gifts.length} hediye a√ßƒ±ldƒ±`;
  }
  updateProgress();

  gifts.forEach((gift, index) => {
    gift.addEventListener("click", () => {
      if (isAnimating || gift.style.visibility === "hidden") return;
      isAnimating = true;

      // üéØ Kutunun ekrandaki konumunu al
      const rect = gift.getBoundingClientRect();
      const x = (rect.left + rect.width / 2) / window.innerWidth;
      const y = (rect.top + rect.height / 2) / window.innerHeight;

      // üéâ Konfeti kutunun tam konumundan √ßƒ±ksƒ±n (hareket azaltma tercihi varsa azalt)
      if (!reducedMotion) {
        confetti({
          particleCount: 100,
          spread: 70,
          origin: { x: x, y: y },
        });
      } else {
        confetti({
          particleCount: 20,
          spread: 45,
          origin: { x: x, y: y },
        });
      }

      // Mesaj g√∂sterimi (hareket azaltma tercihi varsa ge√ßi≈üsiz) ve ekranda kalmasƒ±
      if (!reducedMotion) {
        messageBox.style.opacity = "0";
        setTimeout(() => {
          messageBox.innerText = messages[index];
          messageBox.style.opacity = "1";
          isAnimating = false;
        }, 150);
      } else {
        messageBox.style.opacity = "1";
        messageBox.innerText = messages[index];
        isAnimating = false;
      }

      // Kutuyu gizle
      gift.style.visibility = "hidden";
      clickedCount++;
      updateProgress();

      // Son hediye tƒ±klanƒ±nca 6 saniye beklemeden √∂nce overlay g√∂ster
      if (clickedCount === gifts.length) {
        showFinalOverlay();
      }
    });
  });

  function showFinalOverlay() {
    finalOverlay.style.display = 'flex';
    // Odaƒüƒ± overlay i√ßine al
    lastFocusedBeforeOverlay = document.activeElement;
    setTimeout(() => { stayBtn.focus(); }, 0);
    const totalMs = 6000;
    const start = Date.now();
    updateCountdown(totalMs);
    // Konfeti akƒ±≈üƒ± s√ºrs√ºn (tercih varsa)
    if (!reducedMotion) {
      (function frame() {
        const remaining = totalMs - (Date.now() - start);
        if (remaining > 0) {
          confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, shapes: ['heart'], gravity: 0.4 });
          confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, shapes: ['heart'], gravity: 0.4 });
          requestAnimationFrame(frame);
        }
      })();
    }
    countdownTimer = setInterval(() => {
      const elapsed = Date.now() - start;
      const remaining = Math.max(0, totalMs - elapsed);
      updateCountdown(remaining);
      if (remaining <= 0) {
        clearInterval(countdownTimer);
      }
    }, 100);
    redirectTimer = setTimeout(() => {
      startInAppPlayback();
    }, totalMs);
  }

  function updateCountdown(ms) {
    const s = Math.ceil(ms / 1000);
    countdownEl.textContent = `${s} saniye i√ßinde videon a√ßƒ±lacak...`;
  }

  function hideFinalOverlay() {
    finalOverlay.style.display = 'none';
    if (lastFocusedBeforeOverlay && typeof lastFocusedBeforeOverlay.focus === 'function') {
      lastFocusedBeforeOverlay.focus();
    }
  }

  function startInAppPlayback() {
    if (hasStartedPlayback) return;
    hasStartedPlayback = true;
    const embedUrl = "https://www.youtube.com/embed/0l12yc8tcWs?autoplay=1&rel=0&playsinline=1";
    ytPlayer.src = embedUrl;
    videoContainer.style.display = 'block';
    countdownEl.textContent = 'Videon burada ba≈üladƒ±, keyfini √ßƒ±kar g√ºzelim ‚ù§Ô∏è';
  }

  stayBtn.addEventListener('click', () => {
    if (redirectTimer) clearTimeout(redirectTimer);
    if (countdownTimer) clearInterval(countdownTimer);
    hideFinalOverlay();
  });
  goNowBtn.addEventListener('click', () => {
    if (redirectTimer) clearTimeout(redirectTimer);
    if (countdownTimer) clearInterval(countdownTimer);
    window.location.href = "https://youtu.be/0l12yc8tcWs?si=nGmssbHyb76UGnyE";
  });

  // Overlay i√ßinde klavye tu≈ülarƒ±: ESC kapat, Tab tu≈üunu butonlar arasƒ±nda d√∂nd√ºr
  finalOverlay.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      e.preventDefault();
      if (redirectTimer) clearTimeout(redirectTimer);
      if (countdownTimer) clearInterval(countdownTimer);
      hideFinalOverlay();
    } else if (e.key === 'Tab') {
      const focusables = [stayBtn, goNowBtn].filter(Boolean);
      const idx = focusables.indexOf(document.activeElement);
      let nextIdx = idx;
      if (e.shiftKey) {
        nextIdx = (idx <= 0 ? focusables.length : idx) - 1;
      } else {
        nextIdx = (idx + 1) % focusables.length;
      }
      e.preventDefault();
      focusables[nextIdx].focus();
    }
  });

  // Hediye kutularƒ± i√ßin klavyeyle gezinme (ok tu≈ülarƒ±)
  const giftsContainer = document.getElementById('gifts');
  giftsContainer.addEventListener('keydown', (e) => {
    const visibleGifts = Array.from(gifts).filter(g => g.style.visibility !== 'hidden');
    const current = document.activeElement;
    const idx = visibleGifts.indexOf(current);
    if (idx === -1) return;
    if (["ArrowRight", "ArrowDown"].includes(e.key)) {
      e.preventDefault();
      const next = visibleGifts[(idx + 1) % visibleGifts.length];
      next.focus();
    } else if (["ArrowLeft", "ArrowUp"].includes(e.key)) {
      e.preventDefault();
      const prev = visibleGifts[(idx - 1 + visibleGifts.length) % visibleGifts.length];
      prev.focus();
    }
  });

  // Ba≈ütan ba≈ülat: t√ºm kutularƒ± g√∂r√ºn√ºr yap, saya√ßlarƒ± ve mesajƒ± sƒ±fƒ±rla, bekleyen y√∂nlendirmeyi iptal et
  restartBtn.addEventListener('click', () => {
    if (redirectTimer) clearTimeout(redirectTimer);
    if (countdownTimer) clearInterval(countdownTimer);
    hideFinalOverlay();
    clickedCount = 0;
    isAnimating = false;
    messageBox.style.opacity = '0';
    messageBox.innerText = '';
    gifts.forEach(g => { g.style.visibility = 'visible'; });
    updateProgress();
    // Video ve durumlarƒ± sƒ±fƒ±rla
    if (ytPlayer) ytPlayer.src = '';
    if (videoContainer) videoContainer.style.display = 'none';
    hasStartedPlayback = false;
  });
</script>
</body>
</html>
